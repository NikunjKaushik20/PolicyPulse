<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eligibility Checker - PolicyPulse</title>
  <link rel="stylesheet" href="/static/css/theme.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-content">
      <div class="logo">
        <span>üîç</span>
        <span>PolicyPulse</span>
      </div>
      <nav class="nav">
        <a href="/" class="nav-link">Home</a>
        <a href="/search.html" class="nav-link">Search</a>
        <a href="/eligibility.html" class="nav-link active">Eligibility</a>
        <a href="/voice.html" class="nav-link">Voice</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
          <span id="theme-icon">üåô</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container" style="padding: 2rem 1.5rem; max-width: 900px;">
    <div class="fade-in">
      <h1 class="text-center mb-2">‚úÖ Check Your Eligibility</h1>
      <p class="text-center mb-4" style="color: var(--text-secondary);">
        Find out which government schemes you qualify for
      </p>

      <!-- Profile Form -->
      <div class="card mb-4">
        <h3 class="mb-3">üìù Your Profile</h3>
        
        <div class="grid grid-2">
          <div class="input-group">
            <label class="input-label">Age</label>
            <input type="number" id="age" class="input" placeholder="25" min="0" max="120">
          </div>

          <div class="input-group">
            <label class="input-label">Annual Income (‚Çπ)</label>
            <input type="number" id="income" class="input" placeholder="50000" min="0">
          </div>

          <div class="input-group">
            <label class="input-label">Occupation</label>
            <select id="occupation" class="select">
              <option value="">Select...</option>
              <option value="farmer">Farmer</option>
              <option value="agricultural worker">Agricultural Worker</option>
              <option value="student">Student</option>
              <option value="entrepreneur">Entrepreneur</option>
              <option value="business owner">Business Owner</option>
              <option value="manufacturer">Manufacturer</option>
              <option value="unemployed">Unemployed</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="input-group">
            <label class="input-label">Location Type</label>
            <select id="location_type" class="select">
              <option value="rural">Rural</option>
              <option value="urban">Urban</option>
            </select>
          </div>

          <div class="input-group">
            <label class="input-label">Category</label>
            <select id="category" class="select">
              <option value="general">General</option>
              <option value="sc">SC</option>
              <option value="st">ST</option>
              <option value="obc">OBC</option>
            </select>
          </div>
        </div>

        <h4 class="mt-3 mb-2">Additional Information</h4>
        
        <div class="grid grid-2">
          <div class="flex gap-2" style="align-items: center;">
            <input type="checkbox" id="land_ownership" style="width: auto;">
            <label for="land_ownership">I own agricultural land</label>
          </div>

          <div class="flex gap-2" style="align-items: center;">
            <input type="checkbox" id="has_toilet" style="width: auto;">
            <label for="has_toilet">I have a toilet at home</label>
          </div>

          <div class="flex gap-2" style="align-items: center;">
            <input type="checkbox" id="willingness_manual_work" style="width: auto;">
            <label for="willingness_manual_work">Willing to do manual work</label>
          </div>

          <div class="flex gap-2" style="align-items: center;">
            <input type="checkbox" id="in_smart_city" style="width: auto;">
            <label for="in_smart_city">I live in a Smart City</label>
          </div>
        </div>

        <button id="check-btn" class="btn btn-primary mt-4" style="width: 100%;">
          Check Eligibility
        </button>
      </div>

      <!-- Results Section -->
      <div id="results-container"></div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="/static/js/theme-toggle.js"></script>
  <script src="/static/js/api-client.js"></script>
  <script>
    const checkBtn = document.getElementById('check-btn');
    const resultsContainer = document.getElementById('results-container');

    async function checkEligibility() {
      // Gather form data
      const profile = {
        age: parseInt(document.getElementById('age').value) || 0,
        income: parseInt(document.getElementById('income').value) || 0,
        occupation: document.getElementById('occupation').value,
        location_type: document.getElementById('location_type').value,
        category: document.getElementById('category').value,
        land_ownership: document.getElementById('land_ownership').checked,
        has_toilet: document.getElementById('has_toilet').checked,
        willingness_manual_work: document.getElementById('willingness_manual_work').checked,
        in_smart_city: document.getElementById('in_smart_city').checked
      };

      // Validate
      if (!profile.age || !profile.occupation) {
        alert('Please fill in at least Age and Occupation');
        return;
      }

      // Show loading
      resultsContainer.innerHTML = '<div class="flex-center" style="padding: 3rem;"><div class="spinner"></div></div>';
      checkBtn.disabled = true;
      checkBtn.innerHTML = '‚è≥ Checking...';

      try {
        const response = await apiClient.checkEligibility(profile);
        displayResults(response);
      } catch (error) {
        resultsContainer.innerHTML = `
          <div class="card" style="background: var(--error); color: white;">
            <h4>‚ùå Check Failed</h4>
            <p>${error.message}</p>
          </div>
        `;
      } finally {
        checkBtn.disabled = false;
        checkBtn.innerHTML = 'Check Eligibility';
      }
    }

    function displayResults(schemes) {
      if (!schemes || schemes.length === 0) {
        resultsContainer.innerHTML = `
          <div class="card" style="background: var(--warning); color: white;">
            <h3>‚ö†Ô∏è No Schemes Found</h3>
            <p>Based on your profile, we couldn't find any matching schemes. Try adjusting your information or visit a Jan Seva Kendra for assistance.</p>
          </div>
        `;
        return;
      }

      let html = `
        <div class="card card-gradient mb-3 fade-in">
          <h2>üéâ You're Eligible for ${schemes.length} Scheme${schemes.length > 1 ? 's' : ''}!</h2>
          <p style="color: white; font-size: 1.125rem;">Below are the government schemes you qualify for:</p>
        </div>
      `;

      schemes.forEach((scheme, index) => {
        const priorityColor = scheme.priority === 'HIGH' ? 'var(--success)' : 'var(--accent-primary)';
        
        html += `
          <div class="card mb-3 fade-in" style="animation-delay: ${index * 0.1}s;">
            <div class="flex gap-2 mb-2">
              <span class="badge badge-success">${scheme.policy_id}</span>
              <span class="badge" style="background: ${priorityColor}; color: white;">${scheme.priority} Priority</span>
            </div>
            
            <h3 class="mb-2">${scheme.policy_name}</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
              ${scheme.description}
            </p>
            
            <div class="mb-3" style="background: var(--bg-primary); padding: 1rem; border-radius: 8px;">
              <h4 class="mb-1" style="font-size: 1rem;">üí∞ Benefits:</h4>
              <p style="color: var(--text-secondary); margin: 0;">${scheme.benefits}</p>
            </div>

            <h4 class="mb-1" style="font-size: 1rem;">üìÑ Required Documents:</h4>
            <ul style="margin-bottom: 1rem; color: var(--text-secondary);">
              ${scheme.documents_required.map(doc => `<li>${doc}</li>`).join('')}
            </ul>

            <a href="${scheme.application_link}" target="_blank" class="btn btn-primary" style="width: 100%;">
              Apply Now ‚Üí
            </a>
          </div>
        `;
      });

      resultsContainer.innerHTML = html;
    }

    checkBtn.addEventListener('click', checkEligibility);
  </script>
</body>
</html>
